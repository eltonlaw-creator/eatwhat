<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>今天吃啥</title>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"PingFang SC","Microsoft Yahei",sans-serif; background:#fff7ee; margin:0; color:#0f172a; }
    .stage { width:min(560px,92vw); margin:28px auto 10px; position:relative; }
    canvas#wheel { width:100%; aspect-ratio:1/1; background:#fff; border-radius:50%; border:8px solid #e5e7eb; display:block; }
    /* 指针在12点方向，尖端朝下 */
    .pointer { position:absolute; top:-28px; left:50%; transform:translateX(-50%); width:0; height:0; border-left:18px solid transparent; border-right:18px solid transparent; border-top:32px solid #ef4444; }
    .controls { text-align:center; margin-top: 12px; }
    button { margin: 6px; padding: 10px 18px; font-size: 16px; border:0; border-radius:10px; cursor:pointer; color:#fff; background:linear-gradient(135deg,#ffa7c8,#ff8fab); box-shadow:0 6px 16px rgba(255,143,171,.35);} 
    button.alt{ background:linear-gradient(135deg,#93c5fd,#a7f3d0);} 
    #result { text-align:center; font-size:32px; font-weight:900; margin-top:12px; color:#111827; }
    #itemList { display:flex; flex-wrap:wrap; gap:6px; margin:16px auto; width:min(560px,92vw); justify-content:center; }
    .tag { background:#f8fafc; padding:6px 10px; border-radius:8px; border:1px solid #e2e8f0; }
    footer { text-align:center; margin:16px; color:#334155; font-size:12px; }
    #confetti { position:fixed; inset:0; pointer-events:none; }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <div class="stage">
    <i class="pointer"></i>
    <canvas id="wheel" width="700" height="700"></canvas>
  </div>
  <div class="controls">
    <button id="spinBtn">开始转！</button>
    <button id="refreshBtn" class="alt">换一批(10)</button>
  </div>
  <div id="result">点击开始转！</div>
  <div class="hint" style="text-align:center;color:#64748b;font-size:13px">点击“换一批(10)”可重抽。</div>
  <div id="itemList"></div>
  <footer>Created by Elton</footer>

<script>
const defaultPool = [
  // —— 本地美食 70% (约 140 道) ——
  "炒粿条 Char Kway Teow","槟城虾面 Penang Prawn Mee","福建面 KL Hokkien Mee","云吞面 Wantan Mee","干捞面 Dry Tossed Noodles",
  "砂煲鸡饭 Claypot Chicken Rice","海南鸡饭 Hainanese Chicken Rice","咖喱面 Curry Mee","叻沙 Laksa","板面 Pan Mee",
  "鱼头米粉 Fish Head Bee Hoon","肉骨茶 Bak Kut Teh","老鼠粉 Lou Shu Fan","经济饭 Economy Rice","卤肉饭 Braised Pork Rice",
  "港式烧鸭饭 Roast Duck Rice","叉烧饭 Char Siew Rice","烧肉饭 Crispy Pork Rice","三拼烧腊饭 Mixed Roast Rice","鸡饭粒 Chicken Rice Ball",
  "皮蛋瘦肉粥 Century Egg Pork Porridge","艇仔粥 Boat Congee","鱼片粥 Fish Porridge","潮州粥套餐 Teochew Porridge Set","港式云吞面 HK Wantan Mee",
  "港式猪扒饭 Pork Chop Rice","港式焗饭 Baked Rice","星洲米粉 Singapore Bee Hoon","月光河 Moonlight Hor Fun","干炒牛河 Beef Hor Fun",
  "咸鱼鸡粒炒饭 Salted Fish Fried Rice","扬州炒饭 Yangzhou Fried Rice","番茄炒饭 Tomato Fried Rice","炒伊面 Fried Yee Mee","XO酱炒米粉 XO Fried Vermicelli",
  "酱油鸡饭 Soy Sauce Chicken Rice","三杯鸡饭 Three Cup Chicken Rice","宫保鸡丁饭 Kung Pao Chicken Rice","姜葱鱼片饭 Ginger Fish Fillet Rice","鱼香茄子饭 Yu Xiang Eggplant Rice",
  "芙蓉蛋饭 Fu Yong Egg with Rice","铁板豆腐饭 Hotplate Tofu Rice","咸蛋虾饭 Salted Egg Prawn Rice","麦片鸡饭 Cereal Chicken Rice","椒盐苏东饭 Salt & Pepper Squid Rice",
  "啦啦炒米粉 Lala Bee Hoon","啦啦汤米粉 Lala Soup Bee Hoon","姜葱田鸡饭 Ginger Frog Rice","田鸡粥 Frog Porridge","沙煲豆腐饭 Claypot Tofu Rice",
  "蒜蓉芥兰饭 Garlic Kailan Rice","蒜香排骨饭 Garlic Pork Ribs Rice","梅菜扣肉饭 Preserved Veg Pork Rice","咸鱼花腩煲饭 Salted Fish Pork Belly Rice","招牌炒饭 Signature Fried Rice",
  "Mee Goreng Mamak 马来炒面","Nasi Lemak 椰浆饭","Nasi Goreng 炒饭","Nasi Goreng Kampung 风味炒饭","Nasi Goreng Pattaya 包蛋炒饭",
  "Nasi Kandar 扁担饭","Nasi Tomato 番茄饭","Nasi Dagang 登嘉楼饭","Nasi Kerabu 蓝花饭","Nasi Arab/Bukhari 阿拉伯饭",
  "Beef Rendang 仁当牛肉","Ayam Percik 烤鸡饭","Ayam Masak Merah 红酱鸡饭","Sambal Sotong 参峇鱿鱼饭","Sambal Udang 参峇虾饭",
  "Satay 沙爹","Satay Kajang 加影沙爹","Ikan Bakar 烤魔鬼鱼","Sup Kambing 羊肉汤饭","Sup Ekor 牛尾汤饭",
  "Sup Tulang 骨汤饭","Kari Kepala Ikan 咖喱鱼头饭","Mee Rebus 卤面","Mee Jawa 爪哇面","Mee Soto 印尼鸡汤面",
  "Mee Kari 咖喱面","Mee Siam 暹罗米粉","Mee Hailam 马来炒面","Mee Bandung 麻坡面","Laksa Johor 柔佛叻沙",
  "Laksa Kedah 吉打叻沙","Laksa Kelantan 吉兰丹叻沙","Assam Laksa 亚参叻沙","Maggi Goreng 炒 Maggi","Maggi Sup 汤 Maggi",
  "Maggi Kari 咖喱 Maggi","Roti Canai 印度煎饼","Roti Tisu 飞饼","Roti Telur 鸡蛋饼","Roti Sardin 沙丁鱼饼",
  "Roti Planta 牛油饼","Murtabak Ayam 鸡肉馅饼","Murtabak Daging 牛肉馅饼","Teh Tarik Roti Set 拉茶配饼套餐","Tandoori Chicken 炭炉烤鸡",
  "Naan Set 烤饼套餐","Briyani 香料饭","Lontong 米糕汤","Soto Ayam 鸡汤饭","Ayam Goreng Kampung 甘榜炸鸡饭",
  "Kangkung Belacan 参峇空心菜饭","Otak-otak 乌达","Rojak 罗惹","Cendol 煎蕊","ABC 红豆冰",
  "Pisang Goreng 炸香蕉","Kaya Toast 咖椰面包","Soft-boiled Eggs 半生熟蛋","Kuih Lapis 千层糕","Ondeh-ondeh 椰丝球",

  // —— 外国美食 30% (约 60 道) ——
  // 韩餐
  "Bibimbap 石锅拌饭","Kimchi Fried Rice 泡菜炒饭","Army Stew 部队锅","Samgyeopsal with Rice 韩式烤五花饭","Bulgogi Beef Rice 韩式烤牛肉饭",
  "Tteokbokki 辣炒年糕","Kimchi Jjigae 泡菜锅","Doenjang Jjigae 大酱汤","Sundubu Jjigae 嫩豆腐锅","Korean Fried Chicken 韩式炸鸡",
  // 日餐
  "Ramen 拉面","Udon 乌冬面","Soba 荞麦面","Japanese Curry Rice 日式咖喱饭","Unagi Don 鳗鱼饭",
  "Oyakodon 亲子丼","Gyudon 牛丼","Katsudon 炸猪排饭","Chashu Ramen 叉烧拉面","Miso Ramen 味噌拉面",
  "Tonkotsu Ramen 豚骨拉面","Okonomiyaki 大阪烧","Takoyaki 章鱼烧","Yakisoba 日式炒面","Salmon Sashimi 三文鱼刺身","Sushi 寿司"
  // 泰餐
  "Pad Thai 泰式炒粉","Tom Yum Fried Rice 东炎炒饭","Thai Basil Chicken Rice 打抛鸡饭","Thai Pork Leg Rice 猪脚饭","Thai Green Curry with Rice 绿咖喱饭",
  "Thai Red Curry with Rice 红咖喱饭","Thai Yellow Curry with Rice 黄咖喱饭","Thai Fried Chicken 泰式炸鸡","Thai Boat Noodles 河粉","Thai Omelette Rice 泰式蛋包饭",
  // 西餐
  "Pizza 披萨","Burger 汉堡","Hotdog 热狗","Fish & Chips 炸鱼薯条","Spaghetti Bolognese 肉酱意面",
  "Carbonara 奶油培根意面","Lasagna 千层面","Mac & Cheese 芝士通心粉","Steak 牛排","Grilled Salmon 烤三文鱼",
  "Lamb Chop 羊排","Chicken Chop 鸡排饭","Pork Chop 猪排饭","Fried Chicken 炸鸡套餐","Burrito 墨西哥卷饼",
  "Taco 塔可","Quesadilla 墨西哥烤饼","Nachos 玉米片","Shepherd’s Pie 牧羊人派","Cottage Pie 牛肉派"
];

  const wheel = document.getElementById('wheel');
  const ctx = wheel.getContext('2d');
  const itemList = document.getElementById('itemList');
  const resultDom = document.getElementById('result');
  const spinBtn = document.getElementById('spinBtn');
  const refreshBtn = document.getElementById('refreshBtn');
  const confetti = document.getElementById('confetti');
  const cctx = confetti.getContext('2d');

  let pool = [...defaultPool];
  let items = pickRandom10(pool);
  let angle = 0; let spinning = false; let startAngle=0, targetAngle=0, startTime=0, duration=0;
  let lastTick = -1; let audioCtx = null; let confs = [];

  function pickRandom10(pool){ const arr=[...pool]; for(let i=arr.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr.slice(0,10);} 

  function getIndex(){
    const n = items.length; const slice = Math.PI*2/n;
    const pointerAngle = -Math.PI/2; // 12点朝下
    let rel = (pointerAngle - angle) % (Math.PI*2);
    if (rel < 0) rel += Math.PI*2;
    return Math.floor(rel / slice) % n;
  }

  function easeOutCubic(t){ return 1-Math.pow(1-t,3); }
  function playTick(){ try{ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state==='suspended') audioCtx.resume(); const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='square'; o.frequency.value=1000; g.gain.value=0.02; o.connect(g).connect(audioCtx.destination); o.start(); setTimeout(()=>o.stop(),40);}catch(e){} }

  function drawWheel(){
    const W=wheel.width, H=wheel.height; const cx=W/2, cy=H/2, r=Math.min(W,H)/2-12; ctx.clearRect(0,0,W,H);
    const n=items.length; const slice=Math.PI*2/Math.max(n,1);
    for(let i=0;i<n;i++){
      const start=angle+i*slice, end=start+slice, mid=(start+end)/2; const hue=(i*360/n)|0; 
      const c1=`hsl(${hue} 80% 65%)`, c2=`hsl(${(hue+24)%360} 80% 55%)`; 
      const grad=ctx.createLinearGradient(cx+Math.cos(start)*r, cy+Math.sin(start)*r, cx, cy); grad.addColorStop(0,c1); grad.addColorStop(1,c2);
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,start,end); ctx.closePath(); ctx.fillStyle=grad; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,.5)'; ctx.lineWidth=1.2; ctx.stroke();
      ctx.save(); ctx.translate(cx+Math.cos(mid)*(r*0.72), cy+Math.sin(mid)*(r*0.72)); ctx.rotate(mid+Math.PI/2); ctx.fillStyle='#fff'; ctx.font='700 15px system-ui'; const label=items[i]; const txt=label.length>8?label.slice(0,8)+'…':label; ctx.textAlign='center'; ctx.fillText(txt,0,5); ctx.restore();
    }
    ctx.beginPath(); ctx.arc(cx,cy,58,0,Math.PI*2); ctx.fillStyle='#ffffff'; ctx.fill(); ctx.strokeStyle='#e5e7eb'; ctx.lineWidth=3; ctx.stroke(); ctx.fillStyle='#111827'; ctx.font='700 16px system-ui'; ctx.textAlign='center'; ctx.fillText('今天',cx,cy-4); ctx.fillStyle='#ef4444'; ctx.font='900 20px system-ui'; ctx.fillText('吃啥',cx,cy+20);
  }

  function renderList(){ itemList.innerHTML=''; items.forEach(it=>{ const d=document.createElement('div'); d.className='tag'; d.textContent=it; itemList.appendChild(d); }); }

  function animate(){ if(!spinning) return; const t=Math.min((performance.now()-startTime)/duration,1); angle = startAngle + (targetAngle-startAngle)*easeOutCubic(t); const idx=getIndex(); if(idx!==lastTick){ lastTick=idx; playTick(); } drawWheel(); if(t<1){ requestAnimationFrame(animate); } else { spinning=false; finishSpin(); } }
  function spin(){ if(spinning||items.length===0) return; spinning=true; lastTick=-1; const extra=6+Math.random()*3; startAngle=angle; targetAngle=angle+extra*Math.PI*2+Math.random()*Math.PI*2; duration=2600+Math.random()*800; startTime=performance.now(); requestAnimationFrame(animate); }
  function finishSpin(){ const {label}=getResult(); resultDom.innerHTML = `🎯 命运安排：<b style=\"font-size:28px\">${label}</b>！`; boomConfetti(); }
  function getResult(){ return { index:getIndex(), label: items[getIndex()] }; }

  function boomConfetti(){
    confetti.width = innerWidth; confetti.height = innerHeight;
    confs = new Array(160).fill(0).map(()=>({
      x: innerWidth/2 + (Math.random()-0.5)*200,
      y: innerHeight/3 + (Math.random()-0.5)*120,
      r: 2 + Math.random()*3,
      vx: (Math.random()-0.5)*6,
      vy: -Math.random()*7,
      g: 0.18 + Math.random()*0.22,
      life: 60 + (Math.random()*60|0),
      color: `hsl(${(Math.random()*360)|0} 80% 60%)`
    }));
    drawConfetti();
  }
  function drawConfetti(){
    cctx.clearRect(0,0,confetti.width,confetti.height);
    confs.forEach(p=>{ cctx.beginPath(); cctx.arc(p.x,p.y,p.r,0,Math.PI*2); cctx.fillStyle=p.color; cctx.fill(); p.x+=p.vx; p.y+=p.vy; p.vy+=p.g; p.life--; });
    confs = confs.filter(p=> p.y < confetti.height+10 && p.life>0 );
    if(confs.length) requestAnimationFrame(drawConfetti);
  }
  addEventListener('resize',()=>{ confetti.width=innerWidth; confetti.height=innerHeight; });

  spinBtn.addEventListener('click', spin);
  refreshBtn.addEventListener('click', ()=>{ items=pickRandom10(pool); drawWheel(); renderList(); resultDom.textContent='已换一批！点开始转～'; });

  drawWheel(); renderList();
</script>
</body>
</html>
