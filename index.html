<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>今天吃啥</title>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"PingFang SC","Microsoft Yahei",sans-serif; background:#fff7ee; margin:0; color:#0f172a; }
    .stage { width:min(560px,92vw); margin:28px auto 10px; position:relative; }
    canvas#wheel { width:100%; aspect-ratio:1/1; background:#fff; border-radius:50%; border:8px solid #e5e7eb; display:block; }
    /* 指针在12点方向，尖端朝下 */
    .pointer { position:absolute; top:-28px; left:50%; transform:translateX(-50%); width:0; height:0; border-left:18px solid transparent; border-right:18px solid transparent; border-top:32px solid #ef4444; }
    .controls { text-align:center; margin-top: 12px; }
    button { margin: 6px; padding: 10px 18px; font-size: 16px; border:0; border-radius:10px; cursor:pointer; color:#fff; background:linear-gradient(135deg,#ffa7c8,#ff8fab); box-shadow:0 6px 16px rgba(255,143,171,.35);} 
    button.alt{ background:linear-gradient(135deg,#93c5fd,#a7f3d0);} 
    #result { text-align:center; font-size:32px; font-weight:900; margin-top:12px; color:#111827; }
    #itemList { display:flex; flex-wrap:wrap; gap:6px; margin:16px auto; width:min(560px,92vw); justify-content:center; }
    .tag { background:#f8fafc; padding:6px 10px; border-radius:8px; border:1px solid #e2e8f0; }
    footer { text-align:center; margin:16px; color:#334155; font-size:12px; }
    #confetti { position:fixed; inset:0; pointer-events:none; }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <div class="stage">
    <i class="pointer"></i>
    <canvas id="wheel" width="700" height="700"></canvas>
  </div>
  <div class="controls">
    <button id="spinBtn">开始转！</button>
    <button id="refreshBtn" class="alt">换一批(10)</button>
  </div>
  <div id="result">点击开始转！</div>
  <div class="hint" style="text-align:center;color:#64748b;font-size:13px">点击“换一批(10)”可重抽。</div>
  <div id="itemList"></div>
  <footer>Created by Elton</footer>

<script>
  const defaultPool = [
    "肉骨茶 Bak Kut Teh","炒粿条 Char Kway Teow","福建面 Hokkien Mee","云吞面 Wantan Mee","干捞面 Dry Noodles",
    "砂煲鸡饭 Claypot Chicken Rice","咸蛋鸡 Salted Egg Chicken","海南鸡饭 Hainanese Chicken Rice","咖喱面 Curry Mee","叻沙 Laksa",
    "瓦煲亚参鱼 Assam Fish","清蒸金目鲈 Steamed Seabass","煲仔饭 Claypot Rice","咕噜肉 Sweet & Sour Pork","鱼头米粉 Fish Head Bee Hoon",
    "炒米粉 Fried Bee Hoon","粥品 Congee","烧腊饭 Roast Meat Rice","蒸点 Dim Sum",
    "椰浆饭 Nasi Lemak","仁当牛肉 Beef Rendang","马来炒面 Mee Goreng Mamak","炒饭 Nasi Goreng","沙爹 Satay",
    "亚参叻沙 Assam Laksa","罗惹 Rojak","乌达 Otak-otak","参峇鱿鱼 Sambal Sotong","参峇空心菜 Kangkung Belacan",
    "甘榜炸鸡 Ayam Goreng Kampung","马来烤鱼 Ikan Bakar","马来羊杂 Sup Kambing","黄姜饭 Nasi Kunyit",
    "印度煎饼 Roti Canai","飞饼 Roti Tisu","印度甩饼 Murtabak","扁担饭 Nasi Kandar","炭炉烤鸡 Tandoori Chicken",
    "烤饼配咖喱 Naan Set","香料饭 Briyani","马沙拉多萨 Masala Dosa",
    "沙巴海鲜 Sabah Seafood","砂拉越干盘面 Sarawak Kolo Mee","客家面 Hakka Mee","叻沙海鲜面 Seafood Laksa",
    "煎蕊 Cendol","红豆冰 ABC","炸香蕉 Pisang Goreng","咖椰面包 Kaya Toast","半生熟蛋 Soft-boiled Eggs",
    "泰式罗勒炒肉 Pad Kra Pao","冬阴功 Tom Yum","泰式猪脚饭 Thai Pork Leg Rice","打抛鸡 Basil Chicken Rice",
    "越南河粉 Pho","越南春卷 Spring Roll","芒果糯米饭 Mango Sticky Rice",
    "鸡排饭 Chicken Chop","炸鱼薯条 Fish & Chips","黑椒牛排 Black Pepper Steak","奶油意面 Cream Pasta","披萨 Pizza",
    "汉堡 Burger","热狗 Hotdog","奶油蘑菇汤 Mushroom Soup","凯撒沙拉 Caesar Salad","蒜香面包 Garlic Bread",
    "宫保鸡丁 Kung Pao Chicken","鱼香肉丝 Yu Xiang Pork","回锅肉 Twice-cooked Pork","酸菜鱼 Suan Cai Yu","重庆小面 Chongqing Noodles",
    "担担面 Dan Dan Noodles","麻辣香锅 Mala Dry Pot","香辣蟹 Spicy Crab","口水鸡 Mouth-watering Chicken","手抓饭 Nasi Arab/Bukhari",
    "鸡饭粒 Chicken Rice Ball","老鼠粉 Lou Shu Fan","酿豆腐 Yong Tau Foo","板面 Pan Mee","炒粿角 Char Kuey Kak",
    "马来糕 Kuih","娘惹糕 Nyonya Kuih","咖喱角 Curry Puff","卤肉饭 Braised Pork Rice","东炎炒饭 Tom Yum Fried Rice"
  ];

  const wheel = document.getElementById('wheel');
  const ctx = wheel.getContext('2d');
  const itemList = document.getElementById('itemList');
  const resultDom = document.getElementById('result');
  const spinBtn = document.getElementById('spinBtn');
  const refreshBtn = document.getElementById('refreshBtn');
  const confetti = document.getElementById('confetti');
  const cctx = confetti.getContext('2d');

  let pool = [...defaultPool];
  let items = pickRandom10(pool);
  let angle = 0; let spinning = false; let startAngle=0, targetAngle=0, startTime=0, duration=0;
  let lastTick = -1; let audioCtx = null; let confs = [];

  function pickRandom10(pool){ const arr=[...pool]; for(let i=arr.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr.slice(0,10);} 

  function getIndex(){
    const n = items.length; const slice = Math.PI*2/n;
    const pointerAngle = -Math.PI/2; // 12点朝下
    let rel = (pointerAngle - angle) % (Math.PI*2);
    if (rel < 0) rel += Math.PI*2;
    return Math.floor(rel / slice) % n;
  }

  function easeOutCubic(t){ return 1-Math.pow(1-t,3); }
  function playTick(){ try{ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state==='suspended') audioCtx.resume(); const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='square'; o.frequency.value=1000; g.gain.value=0.02; o.connect(g).connect(audioCtx.destination); o.start(); setTimeout(()=>o.stop(),40);}catch(e){} }

  function drawWheel(){
    const W=wheel.width, H=wheel.height; const cx=W/2, cy=H/2, r=Math.min(W,H)/2-12; ctx.clearRect(0,0,W,H);
    const n=items.length; const slice=Math.PI*2/Math.max(n,1);
    for(let i=0;i<n;i++){
      const start=angle+i*slice, end=start+slice, mid=(start+end)/2; const hue=(i*360/n)|0; 
      const c1=`hsl(${hue} 80% 65%)`, c2=`hsl(${(hue+24)%360} 80% 55%)`; 
      const grad=ctx.createLinearGradient(cx+Math.cos(start)*r, cy+Math.sin(start)*r, cx, cy); grad.addColorStop(0,c1); grad.addColorStop(1,c2);
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,start,end); ctx.closePath(); ctx.fillStyle=grad; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,.5)'; ctx.lineWidth=1.2; ctx.stroke();
      ctx.save(); ctx.translate(cx+Math.cos(mid)*(r*0.72), cy+Math.sin(mid)*(r*0.72)); ctx.rotate(mid+Math.PI/2); ctx.fillStyle='#fff'; ctx.font='700 15px system-ui'; const label=items[i]; const txt=label.length>8?label.slice(0,8)+'…':label; ctx.textAlign='center'; ctx.fillText(txt,0,5); ctx.restore();
    }
    ctx.beginPath(); ctx.arc(cx,cy,58,0,Math.PI*2); ctx.fillStyle='#ffffff'; ctx.fill(); ctx.strokeStyle='#e5e7eb'; ctx.lineWidth=3; ctx.stroke(); ctx.fillStyle='#111827'; ctx.font='700 16px system-ui'; ctx.textAlign='center'; ctx.fillText('今天',cx,cy-4); ctx.fillStyle='#ef4444'; ctx.font='900 20px system-ui'; ctx.fillText('吃啥',cx,cy+20);
  }

  function renderList(){ itemList.innerHTML=''; items.forEach(it=>{ const d=document.createElement('div'); d.className='tag'; d.textContent=it; itemList.appendChild(d); }); }

  function animate(){ if(!spinning) return; const t=Math.min((performance.now()-startTime)/duration,1); angle = startAngle + (targetAngle-startAngle)*easeOutCubic(t); const idx=getIndex(); if(idx!==lastTick){ lastTick=idx; playTick(); } drawWheel(); if(t<1){ requestAnimationFrame(animate); } else { spinning=false; finishSpin(); } }
  function spin(){ if(spinning||items.length===0) return; spinning=true; lastTick=-1; const extra=6+Math.random()*3; startAngle=angle; targetAngle=angle+extra*Math.PI*2+Math.random()*Math.PI*2; duration=2600+Math.random()*800; startTime=performance.now(); requestAnimationFrame(animate); }
  function finishSpin(){ const {label}=getResult(); resultDom.innerHTML = `🎯 命运安排：<b style=\"font-size:28px\">${label}</b>！`; boomConfetti(); }
  function getResult(){ return { index:getIndex(), label: items[getIndex()] }; }

  function boomConfetti(){
    confetti.width = innerWidth; confetti.height = innerHeight;
    confs = new Array(160).fill(0).map(()=>({
      x: innerWidth/2 + (Math.random()-0.5)*200,
      y: innerHeight/3 + (Math.random()-0.5)*120,
      r: 2 + Math.random()*3,
      vx: (Math.random()-0.5)*6,
      vy: -Math.random()*7,
      g: 0.18 + Math.random()*0.22,
      life: 60 + (Math.random()*60|0),
      color: `hsl(${(Math.random()*360)|0} 80% 60%)`
    }));
    drawConfetti();
  }
  function drawConfetti(){
    cctx.clearRect(0,0,confetti.width,confetti.height);
    confs.forEach(p=>{ cctx.beginPath(); cctx.arc(p.x,p.y,p.r,0,Math.PI*2); cctx.fillStyle=p.color; cctx.fill(); p.x+=p.vx; p.y+=p.vy; p.vy+=p.g; p.life--; });
    confs = confs.filter(p=> p.y < confetti.height+10 && p.life>0 );
    if(confs.length) requestAnimationFrame(drawConfetti);
  }
  addEventListener('resize',()=>{ confetti.width=innerWidth; confetti.height=innerHeight; });

  spinBtn.addEventListener('click', spin);
  refreshBtn.addEventListener('click', ()=>{ items=pickRandom10(pool); drawWheel(); renderList(); resultDom.textContent='已换一批！点开始转～'; });

  drawWheel(); renderList();
</script>
</body>
</html>
